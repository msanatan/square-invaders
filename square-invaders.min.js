var Game=Game||{};Game.InputHandler=function(){this.keysDown={},this.lastKey=null,this.mouse={},this.mouse={x:0,y:0,clicked:!1,down:!1},this.pressed=!1},Game.InputHandler.prototype.KEY={BACK_SPACE:8,TAB:9,RTN:13,SHIFT:16,CTRL:17,ALT:18,BREAK:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM_PAD_MULT:106,NUM_PAD_PLUS:107,NUM_PAD_MINUS:109,NUM_PAD_PERIOD:110,NUM_PAD_DIV:111,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},function(){var t;for(t=0;10>t;t++)Game.InputHandler.prototype.KEY[""+t]=48+t}(),function(){var t;for(t=65;91>t;t++)Game.InputHandler.prototype.KEY[""+String.fromCharCode(t)]=t}(),function(){var t;for(t=96;106>t;t++)Game.InputHandler.prototype.KEY["NUM_PAD_"+(t-96)]=t}(),function(){var t;for(t=112;124>t;t++)Game.InputHandler.prototype.KEY["F"+(t-111)]=t}(),Game.InputHandler.prototype.register=function(){var t;t=this,document.addEventListener("keydown",function(e){(e.keyCode!==t.KEY.F5||e.keyCode!==t.KEY.F11)&&(e.preventDefault(),e.stopPropagation()),t.keysDown[e.keyCode]=!0}),document.addEventListener("keyup",function(e){(e.keyCode!==t.KEY.F5||e.keyCode!==t.KEY.F11)&&(e.preventDefault(),e.stopPropagation()),delete t.keysDown[e.keyCode]}),document.addEventListener("mouseover",function(e){t.mouse.x=e.offsetX,t.mouse.y=e.offsetY}),document.addEventListener("mousedown",function(e){t.mouse.down=!0}),document.addEventListener("click",function(e){t.mouse.clicked=!0}),document.addEventListener("mouseup",function(e){t.mouse.down=!1})},Game.InputHandler.prototype.isDown=function(t){return this.keysDown[this.KEY[t]]?!0:!1},Game.InputHandler.prototype.update=function(){var t,e;t=Object.keys(this.keysDown),e=t.length>0?this.keysDown[t[0]]:null,this.pressed=e!==this.lastKey,this.lastKey=this.keysDown[t[0]]},Game.InputHandler.prototype.reset=function(){this.keysDown={},this.lastKey=null,this.mouse={},this.mouse={x:0,y:0,clicked:!1,down:!1},this.pressed=!1};var Game=Game||{};Game.Engine=function(t,e,i,s){"use strict";this.canvas=document.getElementById(t),this.canvas.width=e,this.canvas.height=i,this.FPS=s},Game.Engine.prototype.init=function(){"use strict";this.canvas.focus(),this.ctx=this.canvas.getContext("2d"),this.inputHandler=new Game.InputHandler,this.inputHandler.register()},Game.Engine.prototype.register=function(t){"use strict";this.screen=t},Game.Engine.prototype.update=function(){"use strict";this.inputHandler.update(),this.screen.update(this.inputHandler)},Game.Engine.prototype.render=function(){"use strict";this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.screen.render(this.ctx),this.ctx.restore()},Game.Engine.prototype.stop=function(){this.register(null)},Game.Engine.prototype.switchScreens=function(t){this.stop(),this.inputHandler.reset(),this.register(t),this.step()},Game.Engine.prototype.step=function(){"use strict";this.update(),this.render()};var Game=Game||{};Game.LaserShot=function(t){"use strict";this.width=t.width||8,this.height=t.height||8,this.x=t.x||0,this.y=t.y||0,this.speed=t.speed||15,this.colour=t.colour||"#EEDD88",this.damage=t.damage||5,this.direction="up"===t.direction?-1:1,this.hit=!1},Game.LaserShot.prototype.getBBox=function(){"use strict";return{x:this.x-this.width,y:this.y-this.height,width:2*this.width,height:this.height}},Game.LaserShot.prototype.update=function(){"use strict";this.y+=this.speed*this.direction},Game.LaserShot.prototype.render=function(t){"use strict";t.beginPath(),t.fillStyle=this.colour,t.moveTo(this.x,this.y),t.lineTo(this.x-this.width,this.y-this.height),t.lineTo(this.x+this.width,this.y-this.height),t.fill(),t.closePath()};var Game=Game||{};Game.Sprite=function(t){"use strict";this.width=t.width||20,this.height=t.height||20,this.canvasWidth=t.canvasWidth||1280,this.canvasHeight=t.canvasHeight||640,this.x=t.x||0,this.y=t.y||0,this.xSpeed=t.xSpeed||5,this.ySpeed=t.ySpeed||5,this.colour=t.colour||"#123456",this.health=0,this.laserShots=[],this.hit=!1,this.lastShot=0,this.shotWait=1e3,this.score=0,this.damage=5,this.dead=!1},Game.Sprite.prototype.getBBox=function(){"use strict";return{x:this.x,y:this.y,width:this.width,height:this.height}},Game.Sprite.prototype.getHit=function(t){this.health-=t,this.hit=!0},Game.Sprite.prototype.update=function(){"use strict"},Game.Sprite.prototype.render=function(t){"use strict"};var Game=Game||{};Game.Player=function(t){"use strict";Game.Sprite.call(this,t),this.colour=t.colour||"#AADDCC",this.xSpeed=t.xSpeed||10,this.ySpeed=t.ySpeed||10,this.health=100,this.shotWait=250},Game.Player.prototype=Object.create(Game.Sprite.prototype),Game.Player.constructor=Game.Sprite,Game.Player.prototype.getBBox=function(){"use strict";return{x:this.x-this.width,y:this.y-this.height,width:2*this.width,height:this.height}},Game.Player.prototype.move=function(t,e,i,s){"use strict";this.x+=t,this.y+=e,this.x<=this.width?this.x=this.width:this.x+this.width>=i&&(this.x=i-this.width),this.y<=.75*s?this.y=.75*s:this.y+this.height>=s&&(this.y=s-this.height)},Game.Player.prototype.reset=function(t,e){"use strict";this.x=t,this.y=e,this.health=100,this.laserShots=[],this.lastShot=0,this.score=0,this.dead=!1},Game.Player.prototype.update=function(t){"use strict";var e,i,s;0===this.health&&(this.dead=!0),t.isDown("UP")||t.isDown("W")?this.move(0,-this.ySpeed,this.canvasWidth,this.canvasHeight):t.isDown("DOWN")||t.isDown("S")?this.move(0,this.ySpeed,this.canvasWidth,this.canvasHeight):t.isDown("LEFT")||t.isDown("A")?this.move(-this.xSpeed,0,this.canvasWidth,this.canvasHeight):(t.isDown("RIGHT")||t.isDown("D"))&&this.move(this.xSpeed,0,this.canvasWidth,this.canvasHeight),i=Date.now(),s=i-this.lastShot,t.keysDown[t.KEY.SPACE]&&s>=this.shotWait&&(e={width:7,height:7,x:this.x,y:this.y,speed:10,colour:"#EEDD88",damage:this.damage,direction:"up"},this.laserShots.push(new Game.LaserShot(e)),this.lastShot=i),this.laserShots=this.laserShots.filter(function(t){return t.update(),t.y+t.height>0&&!t.hit})},Game.Player.prototype.render=function(t){"use strict";t.beginPath(),this.hit?t.fillStyle="#FFFFFF":t.strokeStyle=this.colour,t.moveTo(this.x,this.y),t.lineTo(this.x-this.width,this.y+this.height),t.lineTo(this.x+this.width,this.y+this.height),t.lineTo(this.x,this.y),this.hit?t.fill():t.stroke(),t.closePath(),this.laserShots.forEach(function(e){e.render(t)})};var Game=Game||{};Game.getRandomInt=function(t,e){"use strict";return Math.floor(Math.random()*(e-t))+t},Game.BasicEnemy=function(t){"use strict";Game.Sprite.call(this,t),this.xSpeed=2,this.ySpeed=Game.getRandomInt(1,5),this.colour=t.colour||"#66FF33",this.health=5,this.shotWait=1e3},Game.BasicEnemy.prototype=Object.create(Game.Sprite.prototype),Game.BasicEnemy.constructor=Game.Sprite,Game.BasicEnemy.prototype.move=function(t,e,i,s){"use strict";this.x+=t,this.y+=e,this.x<=this.width?this.x=this.width:this.x+this.width>=i&&(this.x=i-this.width),this.y<=0?this.y=0:this.y+this.height>=s&&(this.y=s-this.height)},Game.BasicEnemy.prototype.update=function(){"use strict";var t,e,i;0===this.health&&(this.dead=!0),(this.x<=this.width||this.x>=this.canvasWidth-this.width)&&(this.xSpeed=-this.xSpeed),(this.y<=0||this.y>=.5*this.canvasHeight)&&(this.ySpeed=-this.ySpeed),this.move(this.xSpeed,this.ySpeed,this.canvasWidth,this.canvasHeight),e=Date.now(),i=e-this.lastShot,i>=this.shotWait&&(this.laserShots.push(new Game.LaserShot({width:7,height:7,x:this.x,y:this.y,speed:6,colour:"#EE3366",damage:this.damage,direction:"down"})),this.lastShot=e),t=this,this.laserShots=this.laserShots.filter(function(e){return e.update(),e.y<t.canvasHeight&&!e.hit})},Game.BasicEnemy.prototype.render=function(t){"use strict";t.beginPath(),t.lineWidth="2",t.strokeStyle=this.colour,t.strokeRect(this.x,this.y,this.width,this.height),t.closePath(),this.laserShots.forEach(function(e){e.render(t)})},Game.SolidEnemy=function(t){"use strict";Game.BasicEnemy.call(this,t),this.xSpeed=4,this.ySpeed=Game.getRandomInt(3,6),this.colour=t.colour||"#66FF33",this.health=10,this.shotWait=500},Game.SolidEnemy.prototype=Object.create(Game.BasicEnemy.prototype),Game.SolidEnemy.constructor=Game.BasicEnemy,Game.SolidEnemy.prototype.update=function(){"use strict";var t,e,i;0===this.health&&(this.dead=!0),(this.x<=this.width||this.x>=this.canvasWidth-this.width)&&(this.xSpeed=-this.xSpeed),(this.y<=0||this.y>=.5*this.canvasHeight)&&(this.ySpeed=-this.ySpeed),this.move(this.xSpeed,this.ySpeed,this.canvasWidth,this.canvasHeight),e=Date.now(),i=e-this.lastShot,i>=this.shotWait&&(this.laserShots.push(new Game.LaserShot({width:8,height:8,x:this.x,y:this.y,speed:7,colour:"#EE3366",damage:this.damage,direction:"down"})),this.lastShot=e),t=this,this.laserShots=this.laserShots.filter(function(e){return e.update(),e.y-5*e.height<t.canvasHeight&&!e.hit})},Game.SolidEnemy.prototype.render=function(t){"use strict";var e=this.colour;t.beginPath(),this.hit&&(e="#FFFFFF",this.hit=!1),t.fillStyle=e,t.fillRect(this.x,this.y,this.width,this.height),t.closePath(),this.laserShots.forEach(function(e){e.render(t)})};var Game=Game||{};Game.bboxCollision=function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y?!0:!1},Game.collisionCheck=function(t,e){"use strict";t.laserShots.forEach(function(i){e.forEach(function(e){Game.bboxCollision(i.getBBox(),e.getBBox())&&(e.getHit(i.damage),i.hit=!0,t.score+=i.damage)})}),e.forEach(function(e){e.laserShots.forEach(function(e){Game.bboxCollision(e.getBBox(),t.getBBox())&&(t.getHit(e.damage),e.hit=!0)})})};var Game=Game||{};Game.SquareInvaders=function(t){"use strict";var e;this.width=t.width||1280,this.height=t.height||640,this.pause=!1,e={width:20,height:20,canvasWidth:this.width,canvasHeight:this.height,xSpeed:10,ySpeed:10,x:this.width/2,y:this.height-20},this.player=new Game.Player(e),this.enemies=[],this.spawnWait=1e3,this.lastSpawn=0},Game.SquareInvaders.prototype.reset=function(){"use strict";this.player.reset(this.width/2,this.height-this.player.height),this.enemies=[],this.lastSpawn=0},Game.SquareInvaders.prototype.update=function(t){"use strict";var e,i,s;this.player.dead&&t.pressed&&t.isDown("RTN")&&this.reset(),this.player.hit=!1,t.pressed&&t.isDown("ESC")&&!this.player.dead&&(this.pause=!this.pause),this.pause||this.player.dead||(Game.collisionCheck(this.player,this.enemies),this.player.update(t),this.enemies=this.enemies.filter(function(t){return t.update(),!t.dead}),i=Date.now(),s=i-this.lastSpawn,this.enemies.length<=12&&s>=this.spawnWait&&(e={x:Math.random()*this.width,y:0,canvasWidth:this.width,canvasHeight:this.height},this.player.score<100?this.enemies.push(new Game.BasicEnemy(e)):this.player.score>=100&&this.player.score<=250?this.enemies.push(new Game.SolidEnemy(e)):this.player.score>250&&(this.enemies.push(new Game.BasicEnemy(e)),this.enemies.push(new Game.SolidEnemy(e))),this.lastSpawn=i))},Game.SquareInvaders.prototype.render=function(t){"use strict";var e;t.beginPath(),t.fillStyle="#000000",t.fillRect(0,0,this.width,this.height),t.closePath(),t.beginPath(),this.player.health>=66.66?t.fillStyle="#54EF45":this.player.health<66.66&&this.player.health>=33.33?t.fillStyle="#FFD833":t.fillStyle="#FF4533",t.arc(this.width/20,45,40,0,2*Math.PI,!1),t.fill(),t.lineWidth=1,t.strokeStyle="#FFFFFF",t.stroke(),t.closePath(),t.beginPath(),t.font='30pt "Courier New", Courier, monospace',t.textAlign="center",t.fillStyle="#FFFFFF",t.fillText(this.player.health,this.width/20,60),t.closePath(),t.textAlign="start",t.beginPath(),t.font='25pt "Courier New", Courier, monospace',t.fillStyle="#FFFFFF",t.fillText("Score: "+this.player.score,.75*this.width,40),t.closePath(),this.pause&&(t.beginPath(),t.font="bold 120pt Helvetica, Verdana, sans-serif",t.fillStyle="#FFDD88",e=t.measureText("Paused").width,t.fillText("Paused",this.width/2-e/2,this.height/2),t.closePath()),this.player.dead&&(t.beginPath(),t.font="bold 120pt Helvetica, Verdana, sans-serif",t.fillStyle="#FF4343",e=t.measureText("Game Over").width,t.fillText("Game Over",this.width/2-e/2,this.height/2),t.closePath(),t.beginPath(),t.font="80pt Helvetica, Verdana, sans-serif",t.fillStyle="#FFFFFF",e=t.measureText("Try Again?").width,t.fillText("Try Again?",this.width/2-e/2,this.height/2+120),t.closePath()),this.player.render(t),this.enemies.forEach(function(e){e.render(t)})};var animate,Game=Game||{},WIDTH=window.innerWidth,HEIGHT=window.innerHeight,FPS=30,engine=new Game.Engine("game",WIDTH,HEIGHT,FPS);engine.init(),engine.register(new Game.SquareInvaders({width:WIDTH,height:HEIGHT,FPS:FPS})),animate=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/FPS)},function(){function t(){Game.stopLoop=animate(t),engine.step()}t()}();